{"question": "每个医院中工资最高的医生姓名", "sql": "SELECT hospital_id, name, salary FROM doctor_info WHERE (hospital_id, salary) IN (SELECT hospital_id, MAX(salary) FROM doctor_info GROUP BY hospital_id);"}
{"question": "各医院中医生人数最多的科室", "sql": "SELECT hospital_id, dept_id, doctor_count FROM ( SELECT hospital_id, dept_id, COUNT(*) AS doctor_count, ROW_NUMBER() OVER ( PARTITION BY hospital_id ORDER BY COUNT(*) DESC ) AS rn FROM testdb.doctor_info GROUP BY hospital_id, dept_id ) AS ranked WHERE rn = 1 LIMIT 1000; "}
{"question": "各职称中平均工资最低的医院", "sql": "SELECT d.title, d.hospital_id, ROUND(d.avg_salary, 2) AS avg_salary FROM (SELECT title, hospital_id, AVG(salary) AS avg_salary FROM doctor_info GROUP BY title, hospital_id) AS d JOIN (SELECT title, MIN(avg_salary) AS min_avg_salary FROM (SELECT title, hospital_id, AVG(salary) AS avg_salary FROM doctor_info GROUP BY title, hospital_id) AS s GROUP BY title) AS m ON d.title = m.title AND d.avg_salary = m.min_avg_salary;"}
{"question": "平均工资高于所有医院平均工资的医院", "sql": "SELECT hospital_id, ROUND(AVG(salary), 2) AS avg_salary FROM doctor_info GROUP BY hospital_id HAVING AVG(salary) > (SELECT AVG(salary) FROM doctor_info);"}
{"question": "平均工资超过本医院整体平均工资的职称", "sql": "SELECT hospital_id, title, ROUND(AVG(salary), 2) AS avg_salary FROM doctor_info GROUP BY hospital_id, title HAVING AVG(salary) > (SELECT AVG(salary) FROM doctor_info d2 WHERE d2.hospital_id = doctor_info.hospital_id);"}
{"question": "每个药品类别中单价最高的药品", "sql": "SELECT category, name, unit_price FROM medicine_info WHERE (category, unit_price) IN (SELECT category, MAX(unit_price) FROM medicine_info GROUP BY category);"}
{"question": "住院天数最长的病人姓名", "sql": "SELECT name, DATEDIFF(discharge_date, admission_date) AS stay_days FROM patient_info WHERE DATEDIFF(discharge_date, admission_date) = (SELECT MAX(DATEDIFF(discharge_date, admission_date)) FROM patient_info);"}
{"question": "各医院床位数最多的等级", "sql": "SELECT level, SUM(total_beds) AS total_beds FROM hospital_info GROUP BY level HAVING SUM(total_beds) = (SELECT MAX(sum_beds) FROM (SELECT level, SUM(total_beds) AS sum_beds FROM hospital_info GROUP BY level) AS sub);"}
{"question": "每个护士班次中工龄最长的护士", "sql": "SELECT n.shift, n.name, TIMESTAMPDIFF(YEAR, n.hire_date, CURDATE()) AS work_years FROM nurse_info n WHERE (n.shift, n.hire_date) IN (SELECT shift, MIN(hire_date) FROM nurse_info GROUP BY shift);"}
{"question": "价格高于类别平均价的药品", "sql": "SELECT name, category, unit_price FROM medicine_info WHERE unit_price > (SELECT AVG(unit_price) FROM medicine_info m2 WHERE m2.category = medicine_info.category);"}
{"question": "每个医院中平均工资最高的职称", "sql": "SELECT hospital_id, title, avg_salary FROM (SELECT hospital_id, title, ROUND(AVG(salary), 2) AS avg_salary, ROW_NUMBER() OVER (PARTITION BY hospital_id ORDER BY AVG(salary) DESC) AS rn FROM doctor_info GROUP BY hospital_id, title) AS sub WHERE rn = 1;"}
{"question": "各个医院中平均工资最高的职称", "sql": "SELECT hospital_id, title, avg_salary FROM (SELECT hospital_id, title, ROUND(AVG(salary), 2) AS avg_salary, ROW_NUMBER() OVER (PARTITION BY hospital_id ORDER BY AVG(salary) DESC) AS rn FROM doctor_info GROUP BY hospital_id, title) AS sub WHERE rn = 1;"}
{"question": "每家医院平均工资最高的职称", "sql": "SELECT hospital_id, title, avg_salary FROM (SELECT hospital_id, title, ROUND(AVG(salary), 2) AS avg_salary, ROW_NUMBER() OVER (PARTITION BY hospital_id ORDER BY AVG(salary) DESC) AS rn FROM doctor_info GROUP BY hospital_id, title) AS sub WHERE rn = 1;"}
